!function(){function e(){const e=function(){var r="object",a="function",n="undefined",f=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],l=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],t=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function d(e,t){var n=typeof e[t];return n==a||!!(n==r&&e[t])||n=="unknown"}function i(e,t){return!!(typeof e[t]==r&&e[t])}function e(e,t){return typeof e[t]!=n}function s(r){return function(e,t){var n=t.length;while(n--)if(!r(e,t[n]))return false;return true}}var u=s(d),c=s(i),h=s(e);function g(e){return e&&u(e,o)&&h(e,t)}function v(e){return i(e,"body")?e.body:e.getElementsByTagName("body")[0]}var p,m={},R=typeof window!=n&&typeof document!=n,C={isHostMethod:d,isHostObject:i,isHostProperty:e,areHostMethods:u,areHostObjects:c,areHostProperties:h,isTextRange:g,getBody:v,forEach:[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n],n)}},N={version:"1.3.1-dev",initialized:false,isBrowser:R,supported:true,util:C,features:{},modules:m,config:{alertOnFail:false,alertOnWarn:false,preferTextRange:false,autoInitialize:typeof rangyAutoInitialize==n?true:rangyAutoInitialize}},E,S;function w(e){if(typeof console!=n&&d(console,"log"))console.log(e)}function y(e,t){if(R&&t)alert(e);else w(e)}function T(e){N.initialized=true;N.supported=false;y("Rangy is not supported in this environment. Reason: "+e,N.config.alertOnFail)}function O(e){y("Rangy warning: "+e,N.config.alertOnWarn)}if(N.fail=T,N.warn=O,{}.hasOwnProperty){C.extend=E=function(e,t,n){var r,a;for(var o in t)if(t.hasOwnProperty(o)){r=e[o];a=t[o];if(n&&r!==null&&typeof r=="object"&&a!==null&&typeof a=="object")E(r,a,true);e[o]=a}if(t.hasOwnProperty("toString"))e.toString=t.toString;return e};C.createOptions=function(e,t){var n={};E(n,t);if(e)E(n,e);return n}}else T("hasOwnProperty not supported");if(!R)T("Rangy can only run in a browser");if(function(){var e;if(R){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{if(n.call(t.childNodes,0)[0].nodeType==1)e=function(e){return n.call(e,0)}}catch(e){}}if(!e)e=function(e){var t=[];for(var n=0,r=e.length;n<r;++n)t[n]=e[n];return t};C.toArray=e}(),R){if(d(document,"addEventListener"))S=function(e,t,n){e.addEventListener(t,n,false)};else if(d(document,"attachEvent"))S=function(e,t,n){e.attachEvent("on"+t,n)};else T("Document does not have required addEventListener or attachEvent method");C.addListener=S}var _=[];function D(e){return e.message||e.description||String(e)}function A(){if(!R||N.initialized)return;var e;var t=false,n=false;if(d(document,"createRange")){e=document.createRange();if(u(e,l)&&h(e,f))t=true}var r=v(document);if(!r||r.nodeName.toLowerCase()!="body"){T("No body element found");return}if(r&&d(r,"createTextRange")){e=r.createTextRange();if(g(e))n=true}if(!t&&!n){T("Neither Range nor TextRange are available");return}N.initialized=true;N.features={implementsDomRange:t,implementsTextRange:n};var a,o;for(var i in m)if((a=m[i])instanceof B)a.init(a,N);for(var s=0,c=_.length;s<c;++s)try{_[s](N)}catch(e){o="Rangy init listener threw an exception. Continuing. Detail: "+D(e);w(o)}}function x(e,t,n){if(n)e+=" in module "+n.name;N.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function b(e,t,n,r){e[t]=function(){x(t,n,r);return e[n].apply(e,C.toArray(arguments))}}C.deprecationNotice=x,C.createAliasForDeprecatedMethod=b,N.init=A,N.addInitListener=function(e){if(N.initialized)e(N);else _.push(e)};var I=[];function P(e){e=e||window;A();for(var t=0,n=I.length;t<n;++t)I[t](e)}if(N.addShimListener=function(e){I.push(e)},R){N.shim=N.createMissingNativeApi=P;b(N,"createMissingNativeApi","shim")}function B(e,t,n){this.name=e;this.dependencies=t;this.initialized=false;this.supported=false;this.initializer=n}function M(n,e,r){var t=new B(n,e,function(e){if(!e.initialized){e.initialized=true;try{r(N,e);e.supported=true}catch(e){var t="Module '"+n+"' failed to load: "+D(e);w(t);if(e.stack)w(e.stack)}}});m[n]=t;return t}function k(){}function H(){}B.prototype={init:function(){var e=this.dependencies||[];for(var t=0,n=e.length,r,a;t<n;++t){a=e[t];r=m[a];if(!r||!(r instanceof B))throw new Error("required module '"+a+"' not found");r.init();if(!r.supported)throw new Error("required module '"+a+"' not supported")}this.initializer(this)},fail:function(e){this.initialized=true;this.supported=false;throw new Error(e)},warn:function(e){N.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){N.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},N.createModule=function(e){var t,n;if(arguments.length==2){t=arguments[1];n=[]}else{t=arguments[2];n=arguments[1]}var r=M(e,n,t);if(N.initialized&&N.supported)r.init()},N.createCoreModule=function(e,t,n){M(e,t,n)},N.RangePrototype=k,N.rangePrototype=new k,N.selectionPrototype=new H,N.createCoreModule("DomUtil",[],function(n,f){var r="undefined";var a=n.util;var i=a.getBody;if(!a.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"]))f.fail("document missing a Node creation method");if(!a.isHostMethod(document,"getElementsByTagName"))f.fail("document missing getElementsByTagName method");var e=document.createElement("div");if(!a.areHostMethods(e,["insertBefore","appendChild","cloneNode"]||!a.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"])))f.fail("Incomplete Element implementation");if(!a.isHostProperty(e,"innerHTML"))f.fail("Element is missing innerHTML property");var t=document.createTextNode("test");if(!a.areHostMethods(t,["splitText","deleteData","insertData","appendData","cloneNode"]||!a.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"])||!a.areHostProperties(t,["data"])))f.fail("Incomplete Text Node implementation");var o=function(e,t){var n=e.length;while(n--)if(e[n]===t)return true;return false};function s(e){var t;return typeof e.namespaceURI==r||((t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml")}function c(e){var t=e.parentNode;return t.nodeType==1?t:null}function l(e){var t=0;while(e=e.previousSibling)++t;return t}function d(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function u(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(o(n,r))return r;return null}function h(e,t,n){var r=n?t:t.parentNode;while(r)if(r===e)return true;else r=r.parentNode;return false}function g(e,t){return h(e,t,true)}function v(e,t,n){var r,a=n?e:e.parentNode;while(a){r=a.parentNode;if(r===t)return a;a=r}return null}function p(e){var t=e.nodeType;return t==3||t==4||t==8}function m(e){if(!e)return false;var t=e.nodeType;return t==3||t==8}function R(e,t){var n=t.nextSibling,r=t.parentNode;if(n)r.insertBefore(e,n);else r.appendChild(e);return e}function C(e,t,n){var r=e.cloneNode(false);r.deleteData(0,t);e.deleteData(t,e.length-t);R(r,e);if(n)for(var a=0,o;o=n[a++];)if(o.node==e&&o.offset>t){o.node=r;o.offset-=t}else if(o.node==e.parentNode&&o.offset>l(e))++o.offset;return r}function N(e){if(e.nodeType==9)return e;else if(typeof e.ownerDocument!=r)return e.ownerDocument;else if(typeof e.document!=r)return e.document;else if(e.parentNode)return N(e.parentNode);else throw f.createError("getDocument: no document found for node")}function E(e){var t=N(e);if(typeof t.defaultView!=r)return t.defaultView;else if(typeof t.parentWindow!=r)return t.parentWindow;else throw f.createError("Cannot get a window object for node")}function S(e){if(typeof e.contentDocument!=r)return e.contentDocument;else if(typeof e.contentWindow!=r)return e.contentWindow.document;else throw f.createError("getIframeDocument: No Document object found for iframe element")}function w(e){if(typeof e.contentWindow!=r)return e.contentWindow;else if(typeof e.contentDocument!=r)return e.contentDocument.defaultView;else throw f.createError("getIframeWindow: No Window object found for iframe element")}function y(e){return e&&a.isHostMethod(e,"setTimeout")&&a.isHostObject(e,"document")}function T(e,t,n){var r;if(!e)r=document;else if(a.isHostProperty(e,"nodeType"))r=e.nodeType==1&&e.tagName.toLowerCase()=="iframe"?S(e):N(e);else if(y(e))r=e.document;if(!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r}function O(e){var t;while(t=e.parentNode)e=t;return e}function _(e,t,n,r){var a,o,i,s,c;if(e==n)return t===r?0:t<r?-1:1;else if(a=v(n,e,true))return t<=l(a)?-1:1;else if(a=v(e,n,true))return l(a)<r?-1:1;else{o=u(e,n);if(!o)throw new Error("comparePoints error: nodes have no common ancestor");i=e===o?o:v(e,o,true);s=n===o?o:v(n,o,true);if(i===s)throw f.createError("comparePoints got to case 4 and childA and childB are the same!");else{c=o.firstChild;while(c){if(c===i)return-1;else if(c===s)return 1;c=c.nextSibling}}}}var D=false;function A(e){var t;try{t=e.parentNode;return false}catch(e){return true}}(function(){var e=document.createElement("b");e.innerHTML="1";var t=e.firstChild;e.innerHTML="<br />";D=A(t);n.features.crashyTextNodes=D})();function x(e){if(!e)return"[No node]";if(D&&A(e))return"[Broken node]";if(p(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+l(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function b(e){var t=N(e).createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t}var I;if(typeof window.getComputedStyle!=r)I=function(e,t){return E(e).getComputedStyle(e,null)[t]};else if(typeof document.documentElement.currentStyle!=r)I=function(e,t){return e.currentStyle?e.currentStyle[t]:""};else f.fail("No means of obtaining computed style properties found");function P(e,t,n){var r=i(e);var a=e.createElement("div");a.contentEditable=""+!!n;if(t)a.innerHTML=t;var o=r.firstChild;if(o)r.insertBefore(a,o);else r.appendChild(a);return a}function B(e){return e.parentNode.removeChild(e)}function M(e){this.root=e;this._next=e}M.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;var t,n;if(this._current){t=e.firstChild;if(t)this._next=t;else{n=null;while(e!==this.root&&!(n=e.nextSibling))e=e.parentNode;this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}};function k(e){return new M(e)}function H(e,t){this.node=e;this.offset=t}H.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function L(e){this.code=this[e];this.codeName=e;this.message="DOMException: "+this.codeName}L.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};L.prototype.toString=function(){return this.message};n.dom={arrayContains:o,isHtmlNamespace:s,parentElement:c,getNodeIndex:l,getNodeLength:d,getCommonAncestor:u,isAncestorOf:h,isOrIsAncestorOf:g,getClosestAncestorIn:v,isCharacterDataNode:p,isTextOrCommentNode:m,insertAfter:R,splitDataNode:C,getDocument:N,getWindow:E,getIframeWindow:w,getIframeDocument:S,getBody:i,isWindow:y,getContentDocument:T,getRootContainer:O,comparePoints:_,isBrokenNode:A,inspectNode:x,getComputedStyleProperty:I,createTestElement:P,removeNode:B,fragmentFromNodeChildren:b,createIterator:k,DomPosition:H};n.DOMException=L}),N.createCoreModule("DomRange",["DomUtil"],function(i,e){var s=i.dom;var r=i.util;var t=s.DomPosition;var o=i.DOMException;var d=s.isCharacterDataNode;var u=s.getNodeIndex;var c=s.isOrIsAncestorOf;var a=s.getDocument;var f=s.comparePoints;var l=s.splitDataNode;var h=s.getClosestAncestorIn;var g=s.getNodeLength;var v=s.arrayContains;var p=s.getRootContainer;var n=i.features.crashyTextNodes;var m=s.removeNode;function R(e,t){return e.nodeType!=3&&(c(e,t.startContainer)||c(e,t.endContainer))}function C(e){return e.document||a(e.startContainer)}function N(e){return p(e.startContainer)}function E(e){return new t(e.parentNode,u(e))}function S(e){return new t(e.parentNode,u(e)+1)}function w(e,t,n){var r=e.nodeType==11?e.firstChild:e;if(d(t))if(n==t.length)s.insertAfter(e,t);else t.parentNode.insertBefore(e,n==0?t:l(t,n));else if(n>=t.childNodes.length)t.appendChild(e);else t.insertBefore(e,t.childNodes[n]);return r}function y(e,t,n){$(e);$(t);if(C(t)!=C(e))throw new o("WRONG_DOCUMENT_ERR");var r=f(e.startContainer,e.startOffset,t.endContainer,t.endOffset),a=f(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&a>=0:r<0&&a>0}function T(e){var t;for(var n,r=C(e.range).createDocumentFragment(),a;n=e.next();){t=e.isPartiallySelectedSubtree();n=n.cloneNode(!t);if(t){a=e.getSubtreeIterator();n.appendChild(T(a));a.detach()}if(n.nodeType==10)throw new o("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function O(e,t,n){var r,a;n=n||{stop:false};for(var o,i;o=e.next();)if(e.isPartiallySelectedSubtree())if(t(o)===false){n.stop=true;return}else{i=e.getSubtreeIterator();O(i,t,n);i.detach();if(n.stop)return}else{r=s.createIterator(o);while(a=r.next())if(t(a)===false){n.stop=true;return}}}function _(e){var t;while(e.next())if(e.isPartiallySelectedSubtree()){t=e.getSubtreeIterator();_(t);t.detach()}else e.remove()}function D(e){for(var t,n=C(e.range).createDocumentFragment(),r;t=e.next();){if(e.isPartiallySelectedSubtree()){t=t.cloneNode(false);r=e.getSubtreeIterator();t.appendChild(D(r));r.detach()}else e.remove();if(t.nodeType==10)throw new o("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function A(r,e,a){var o=!!(e&&e.length),i;var s=!!a;if(o)i=new RegExp("^("+e.join("|")+")$");var c=[];O(new b(r,false),function(e){if(o&&!i.test(e.nodeType))return;if(s&&!a(e))return;var t=r.startContainer;if(e==t&&d(t)&&r.startOffset==t.length)return;var n=r.endContainer;if(e==n&&d(n)&&r.endOffset==0)return;c.push(e)});return c}function x(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+s.inspectNode(e.startContainer)+":"+e.startOffset+", "+s.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function b(e,t){this.range=e;this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer;this.so=e.startOffset;this.ec=e.endContainer;this.eo=e.endOffset;var n=e.commonAncestorContainer;if(this.sc===this.ec&&d(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=this.sc===n&&!d(this.sc)?this.sc.childNodes[this.so]:h(this.sc,n,true);this._last=this.ec===n&&!d(this.ec)?this.ec.childNodes[this.eo-1]:h(this.ec,n,true)}}}b.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;if(e){this._next=e!==this._last?e.nextSibling:null;if(d(e)&&this.clonePartiallySelectedTextNodes){if(e===this.ec)(e=e.cloneNode(true)).deleteData(this.eo,e.length-this.eo);if(this._current===this.sc)(e=e.cloneNode(true)).deleteData(0,this.so)}}return e},remove:function(){var e=this._current,t,n;if(d(e)&&(e===this.sc||e===this.ec)){t=e===this.sc?this.so:0;n=e===this.ec?this.eo:e.length;if(t!=n)e.deleteData(t,n-t)}else if(e.parentNode)m(e);else;},isPartiallySelectedSubtree:function(){var e=this._current;return R(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode){e=this.range.cloneRange();e.collapse(false)}else{e=new pe(C(this.range));var t=this._current;var n=t,r=0,a=t,o=g(t);if(c(t,this.sc)){n=this.sc;r=this.so}if(c(t,this.ec)){a=this.ec;o=this.eo}ve(e,n,r,a,o)}return new b(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var I=[1,3,4,5,7,8,10];var P=[2,9,11];var B=[5,6,10,12];var M=[1,3,4,5,7,8,10,11];var k=[1,3,4,5,7,8];function H(a){return function(e,t){var n,r=t?e:e.parentNode;while(r){n=r.nodeType;if(v(a,n))return r;r=r.parentNode}return null}}var L=H([9,11]);var W=H(B);var F=H([6,10,12]);function j(e,t){if(F(e,t))throw new o("INVALID_NODE_TYPE_ERR")}function z(e,t){if(!v(t,e.nodeType))throw new o("INVALID_NODE_TYPE_ERR")}function V(e,t){if(t<0||t>(d(e)?e.length:e.childNodes.length))throw new o("INDEX_SIZE_ERR")}function U(e,t){if(L(e,true)!==L(t,true))throw new o("WRONG_DOCUMENT_ERR")}function q(e){if(W(e,true))throw new o("NO_MODIFICATION_ALLOWED_ERR")}function Y(e,t){if(!e)throw new o(t)}function Q(e,t){return t<=(d(e)?e.length:e.childNodes.length)}function G(e){return!!e.startContainer&&!!e.endContainer&&!(n&&(s.isBrokenNode(e.startContainer)||s.isBrokenNode(e.endContainer)))&&p(e.startContainer)==p(e.endContainer)&&Q(e.startContainer,e.startOffset)&&Q(e.endContainer,e.endOffset)}function $(e){if(!G(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var X=document.createElement("style");var Z=false;try{X.innerHTML="<b>x</b>";Z=X.firstChild.nodeType==3}catch(e){}i.features.htmlParsingConforms=Z;var J=Z?function(e){var t=this.startContainer;var n=a(t);if(!t)throw new o("INVALID_STATE_ERR");var r=null;if(t.nodeType==1)r=t;else if(d(t))r=s.parentElement(t);if(r===null||r.nodeName=="HTML"&&s.isHtmlNamespace(a(r).documentElement)&&s.isHtmlNamespace(r))r=n.createElement("body");else r=r.cloneNode(false);r.innerHTML=e;return s.fragmentFromNodeChildren(r)}:function(e){var t=C(this);var n=t.createElement("body");n.innerHTML=e;return s.fragmentFromNodeChildren(n)};function K(e,t){$(e);var n=e.startContainer,r=e.startOffset,a=e.endContainer,o=e.endOffset;var i=n===a;if(d(a)&&o>0&&o<a.length)l(a,o,t);if(d(n)&&r>0&&r<n.length){n=l(n,r,t);if(i){o-=r;a=n}else if(a==n.parentNode&&o>=u(n))o++;r=0}e.setStartAndEnd(n,r,a,o)}function ee(e){$(e);var t=e.commonAncestorContainer.parentNode.cloneNode(false);t.appendChild(e.cloneContents());return t.innerHTML}var te=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var ne=0,re=1,ae=2,oe=3;var ie=0,se=1,ce=2,fe=3;r.extend(i.rangePrototype,{compareBoundaryPoints:function(e,t){$(this);U(this.startContainer,t.startContainer);var n,r,a,o;var i=e==oe||e==ne?"start":"end";var s=e==re||e==ne?"start":"end";n=this[i+"Container"];r=this[i+"Offset"];a=t[s+"Container"];o=t[s+"Offset"];return f(n,r,a,o)},insertNode:function(e){$(this);z(e,M);q(this.startContainer);if(c(e,this.startContainer))throw new o("HIERARCHY_REQUEST_ERR");var t=w(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){$(this);var e,t;if(this.collapsed)return C(this).createDocumentFragment();else{if(this.startContainer===this.endContainer&&d(this.startContainer)){e=this.startContainer.cloneNode(true);e.data=e.data.slice(this.startOffset,this.endOffset);t=C(this).createDocumentFragment();t.appendChild(e);return t}else{var n=new b(this,true);e=T(n);n.detach()}return e}},canSurroundContents:function(){$(this);q(this.startContainer);q(this.endContainer);var e=new b(this,true);var t=e._first&&R(e._first,this)||e._last&&R(e._last,this);e.detach();return!t},surroundContents:function(e){z(e,k);if(!this.canSurroundContents())throw new o("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())while(e.lastChild)e.removeChild(e.lastChild);w(e,this.startContainer,this.startOffset);e.appendChild(t);this.selectNode(e)},cloneRange:function(){$(this);var e=new pe(C(this));var t=te.length,n;while(t--){n=te[t];e[n]=this[n]}return e},toString:function(){$(this);var e=this.startContainer;if(e===this.endContainer&&d(e))return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):"";else{var t=[],n=new b(this,true);O(n,function(e){if(e.nodeType==3||e.nodeType==4)t.push(e.data)});n.detach();return t.join("")}},compareNode:function(e){$(this);var t=e.parentNode;var n=u(e);if(!t)throw new o("NOT_FOUND_ERR");var r=this.comparePoint(t,n),a=this.comparePoint(t,n+1);if(r<0)return a>0?ce:ie;else return a>0?se:fe},comparePoint:function(e,t){$(this);Y(e,"HIERARCHY_REQUEST_ERR");U(e,this.startContainer);if(f(e,t,this.startContainer,this.startOffset)<0)return-1;else if(f(e,t,this.endContainer,this.endOffset)>0)return 1;return 0},createContextualFragment:J,toHtml:function(){return ee(this)},intersectsNode:function(e,t){$(this);if(p(e)!=N(this))return false;var n=e.parentNode,r=u(e);if(!n)return true;var a=f(n,r,this.endContainer,this.endOffset),o=f(n,r+1,this.startContainer,this.startOffset);return t?a<=0&&o>=0:a<0&&o>0},isPointInRange:function(e,t){$(this);Y(e,"HIERARCHY_REQUEST_ERR");U(e,this.startContainer);return f(e,t,this.startContainer,this.startOffset)>=0&&f(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return y(this,e,false)},intersectsOrTouchesRange:function(e){return y(this,e,true)},intersection:function(e){if(this.intersectsRange(e)){var t=f(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=f(this.endContainer,this.endOffset,e.endContainer,e.endOffset);var r=this.cloneRange();if(t==-1)r.setStart(e.startContainer,e.startOffset);if(n==1)r.setEnd(e.endContainer,e.endOffset);return r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();if(f(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1)t.setStart(e.startContainer,e.startOffset);if(f(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1)t.setEnd(e.endContainer,e.endOffset);return t}else throw new o("Ranges do not intersect")},containsNode:function(e,t){if(t)return this.intersectsNode(e,false);else return this.compareNode(e)==fe},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,g(e))<=0},containsRange:function(e){var t=this.intersection(e);return t!==null&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);return this.containsRange(t)}else return this.containsNodeContents(e)},getNodes:function(e,t){$(this);return A(this,e,t)},getDocument:function(){return C(this)},collapseBefore:function(e){this.setEndBefore(e);this.collapse(false)},collapseAfter:function(e){this.setStartAfter(e);this.collapse(true)},getBookmark:function(e){var t=C(this);var n=i.createRange(t);e=e||s.getBody(t);n.selectNodeContents(e);var r=this.intersection(n);var a=0,o=0;if(r){n.setEnd(r.startContainer,r.startOffset);a=n.toString().length;o=a+r.toString().length}return{start:a,end:o,containerNode:e}},moveToBookmark:function(e){var t=e.containerNode;var n=0;this.setStart(t,0);this.collapse(true);var r=[t],a,o=false,i=false;var s,c,f;while(!i&&(a=r.pop()))if(a.nodeType==3){s=n+a.length;if(!o&&e.start>=n&&e.start<=s){this.setStart(a,e.start-n);o=true}if(o&&e.end>=n&&e.end<=s){this.setEnd(a,e.end-n);i=true}n=s}else{f=a.childNodes;c=f.length;while(c--)r.push(f[c])}},getName:function(){return"DomRange"},equals:function(e){return pe.rangesEqual(this,e)},isValid:function(){return G(this)},inspect:function(){return x(this)},detach:function(){}});function le(e){e.START_TO_START=ne;e.START_TO_END=re;e.END_TO_END=ae;e.END_TO_START=oe;e.NODE_BEFORE=ie;e.NODE_AFTER=se;e.NODE_BEFORE_AND_AFTER=ce;e.NODE_INSIDE=fe}function de(e){le(e);le(e.prototype)}function ue(s,c){return function(){$(this);var e=this.startContainer,t=this.startOffset,n=this.commonAncestorContainer;var r=new b(this,true);var a,o;if(e!==n){a=h(e,n,true);o=S(a);e=o.node;t=o.offset}O(r,q);r.reset();var i=s(r);r.detach();c(this,e,t,e,t);return i}}function he(e,l){function t(n,r){return function(e){z(e,I);z(p(e),P);var t=(n?E:S)(e);(r?a:o)(this,t.node,t.offset)}}function a(e,t,n){var r=e.endContainer,a=e.endOffset;if(t!==e.startContainer||n!==e.startOffset){if(p(t)!=p(r)||f(t,n,r,a)==1){r=t;a=n}l(e,t,n,r,a)}}function o(e,t,n){var r=e.startContainer,a=e.startOffset;if(t!==e.endContainer||n!==e.endOffset){if(p(t)!=p(r)||f(t,n,r,a)==-1){r=t;a=n}l(e,r,a,t,n)}}var n=function(){};n.prototype=i.rangePrototype;e.prototype=new n;r.extend(e.prototype,{setStart:function(e,t){j(e,true);V(e,t);a(this,e,t)},setEnd:function(e,t){j(e,true);V(e,t);o(this,e,t)},setStartAndEnd:function(){var e=arguments;var t=e[0],n=e[1],r=t,a=n;switch(e.length){case 3:a=e[2];break;case 4:r=e[2];a=e[3];break}l(this,t,n,r,a)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:t(true,true),setStartAfter:t(false,true),setEndBefore:t(true,false),setEndAfter:t(false,false),collapse:function(e){$(this);if(e)l(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset);else l(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){j(e,true);l(this,e,0,e,g(e))},selectNode:function(e){j(e,false);z(e,I);var t=E(e),n=S(e);l(this,t.node,t.offset,n.node,n.offset)},extractContents:ue(D,l),deleteContents:ue(_,l),canSurroundContents:function(){$(this);q(this.startContainer);q(this.endContainer);var e=new b(this,true);var t=e._first&&R(e._first,this)||e._last&&R(e._last,this);e.detach();return!t},splitBoundaries:function(){K(this)},splitBoundariesPreservingPositions:function(e){K(this,e)},normalizeBoundaries:function(){$(this);var a=this.startContainer,o=this.startOffset,i=this.endContainer,s=this.endOffset;var e=function(e){var t=e.nextSibling;if(t&&t.nodeType==e.nodeType){i=e;s=e.length;e.appendData(t.data);m(t)}};var t=function(e){var t=e.previousSibling;if(t&&t.nodeType==e.nodeType){a=e;var n=e.length;o=t.length;e.insertData(0,t.data);m(t);if(a==i){s+=o;i=a}else if(i==e.parentNode){var r=u(e);if(s==r){i=e;s=n}else if(s>r)s--}}};var n=true;var r;if(d(i)){if(s==i.length)e(i);else if(s==0){r=i.previousSibling;if(r&&r.nodeType==i.nodeType){s=r.length;if(a==i)n=false;r.appendData(i.data);m(i);i=r}}}else{if(s>0){var c=i.childNodes[s-1];if(c&&d(c))e(c)}n=!this.collapsed}if(n){if(d(a)){if(o==0)t(a);else if(o==a.length){r=a.nextSibling;if(r&&r.nodeType==a.nodeType){if(i==r){i=a;s+=a.length}a.appendData(r.data);m(r)}}}else if(o<a.childNodes.length){var f=a.childNodes[o];if(f&&d(f))t(f)}}else{a=i;o=s}l(this,a,o,i,s)},collapseToPoint:function(e,t){j(e,true);V(e,t);this.setStartAndEnd(e,t)}});de(e)}function ge(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset;e.commonAncestorContainer=e.collapsed?e.startContainer:s.getCommonAncestor(e.startContainer,e.endContainer)}function ve(e,t,n,r,a){e.startContainer=t;e.startOffset=n;e.endContainer=r;e.endOffset=a;e.document=s.getDocument(t);ge(e)}function pe(e){this.startContainer=e;this.startOffset=0;this.endContainer=e;this.endOffset=0;this.document=e;ge(this)}he(pe,ve);r.extend(pe,{rangeProperties:te,RangeIterator:b,copyComparisonConstants:de,createPrototypeRange:he,inspect:x,toHtml:ee,getRangeDocument:C,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}});i.DomRange=pe}),N.createCoreModule("WrappedRange",["DomRange"],function(d,u){var h,e;var S=d.dom;var g=d.util;var w=S.DomPosition;var v=d.DomRange;var p=S.getBody;var m=S.getContentDocument;var y=S.isCharacterDataNode;if(d.features.implementsDomRange)(function(){var t;var r=v.rangeProperties;function a(e){var t=r.length,n;while(t--){n=r[t];e[n]=e.nativeRange[n]}e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function e(e,t,n,r,a){var o=e.startContainer!==t||e.startOffset!=n;var i=e.endContainer!==r||e.endOffset!=a;var s=!e.equals(e.nativeRange);if(o||i||s){e.setEnd(r,a);e.setStart(t,n)}}var n;h=function(e){if(!e)throw u.createError("WrappedRange: Range must be specified");this.nativeRange=e;a(this)};v.createPrototypeRange(h,e);t=h.prototype;t.selectNode=function(e){this.nativeRange.selectNode(e);a(this)};t.cloneContents=function(){return this.nativeRange.cloneContents()};t.surroundContents=function(e){this.nativeRange.surroundContents(e);a(this)};t.collapse=function(e){this.nativeRange.collapse(e);a(this)};t.cloneRange=function(){return new h(this.nativeRange.cloneRange())};t.refresh=function(){a(this)};t.toString=function(){return this.nativeRange.toString()};var o=document.createTextNode("test");p(document).appendChild(o);var i=document.createRange();i.setStart(o,0);i.setEnd(o,0);try{i.setStart(o,1);t.setStart=function(e,t){this.nativeRange.setStart(e,t);a(this)};t.setEnd=function(e,t){this.nativeRange.setEnd(e,t);a(this)};n=function(t){return function(e){this.nativeRange[t](e);a(this)}}}catch(e){t.setStart=function(t,n){try{this.nativeRange.setStart(t,n)}catch(e){this.nativeRange.setEnd(t,n);this.nativeRange.setStart(t,n)}a(this)};t.setEnd=function(t,n){try{this.nativeRange.setEnd(t,n)}catch(e){this.nativeRange.setStart(t,n);this.nativeRange.setEnd(t,n)}a(this)};n=function(n,r){return function(t){try{this.nativeRange[n](t)}catch(e){this.nativeRange[r](t);this.nativeRange[n](t)}a(this)}}}t.setStartBefore=n("setStartBefore","setEndBefore");t.setStartAfter=n("setStartAfter","setEndAfter");t.setEndBefore=n("setEndBefore","setStartBefore");t.setEndAfter=n("setEndAfter","setStartAfter");t.selectNodeContents=function(e){this.setStartAndEnd(e,0,S.getNodeLength(e))};i.selectNodeContents(o);i.setEnd(o,3);var s=document.createRange();s.selectNodeContents(o);s.setEnd(o,4);s.setStart(o,2);if(i.compareBoundaryPoints(i.START_TO_END,s)==-1&&i.compareBoundaryPoints(i.END_TO_START,s)==1)t.compareBoundaryPoints=function(e,t){t=t.nativeRange||t;if(e==t.START_TO_END)e=t.END_TO_START;else if(e==t.END_TO_START)e=t.START_TO_END;return this.nativeRange.compareBoundaryPoints(e,t)};else t.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var c=document.createElement("div");c.innerHTML="123";var f=c.firstChild;var l=p(document);l.appendChild(c);i.setStart(f,1);i.setEnd(f,2);i.deleteContents();if(f.data=="13"){t.deleteContents=function(){this.nativeRange.deleteContents();a(this)};t.extractContents=function(){var e=this.nativeRange.extractContents();a(this);return e}}else;l.removeChild(c);l=null;if(g.isHostMethod(i,"createContextualFragment"))t.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)};p(document).removeChild(o);t.getName=function(){return"WrappedRange"};d.WrappedRange=h;d.createNativeRange=function(e){e=m(e,u,"createNativeRange");return e.createRange()}})();if(d.features.implementsTextRange){var a=function(e){var t=e.parentElement();var n=e.duplicate();n.collapse(true);var r=n.parentElement();n=e.duplicate();n.collapse(false);var a=n.parentElement();var o=r==a?r:S.getCommonAncestor(r,a);return o==t?o:S.getCommonAncestor(t,o)};var o=function(e){return e.compareEndPoints("StartToEnd",e)==0};var i=function(e,t,n,r,a){var o=e.duplicate();o.collapse(n);var i=o.parentElement();if(!S.isOrIsAncestorOf(t,i))i=t;if(!i.canHaveHTML){var s=new w(i.parentNode,S.getNodeIndex(i));return{boundaryPosition:s,nodeInfo:{nodeIndex:s.offset,containerElement:s.node}}}var c=S.getDocument(i).createElement("span");if(c.parentNode)S.removeNode(c);var f,l=n?"StartToStart":"StartToEnd";var d,u,h,g;var v=a&&a.containerElement==i?a.nodeIndex:0;var p=i.childNodes.length;var m=p;var R=m;while(true){if(R==p)i.appendChild(c);else i.insertBefore(c,i.childNodes[R]);o.moveToElementText(c);f=o.compareEndPoints(l,e);if(f==0||v==m)break;else if(f==-1)if(m==v+1)break;else v=R;else m=m==v+1?v:R;R=Math.floor((v+m)/2);i.removeChild(c)}g=c.nextSibling;if(f==-1&&g&&y(g)){o.setEndPoint(n?"EndToStart":"EndToEnd",e);var C;if(/[\r\n]/.test(g.data)){var N=o.duplicate();var E=N.text.replace(/\r\n/g,"\r").length;C=N.moveStart("character",E);while((f=N.compareEndPoints("StartToEnd",N))==-1){C++;N.moveStart("character",1)}}else C=o.text.length;h=new w(g,C)}else{d=(r||!n)&&c.previousSibling;u=(r||n)&&c.nextSibling;if(u&&y(u))h=new w(u,0);else if(d&&y(d))h=new w(d,d.data.length);else h=new w(i,S.getNodeIndex(c))}S.removeNode(c);return{boundaryPosition:h,nodeInfo:{nodeIndex:R,containerElement:i}}};var s=function(e,t){var n,r,a=e.offset;var o=S.getDocument(e.node);var i,s,c=p(o).createTextRange();var f=y(e.node);if(f){n=e.node;r=n.parentNode}else{s=e.node.childNodes;n=a<s.length?s[a]:null;r=e.node}i=o.createElement("span");i.innerHTML="&#feff;";if(n)r.insertBefore(i,n);else r.appendChild(i);c.moveToElementText(i);c.collapse(!t);r.removeChild(i);if(f)c[t?"moveStart":"moveEnd"]("character",a);return c};e=function(e){this.textRange=e;this.refresh()};e.prototype=new v(document);e.prototype.refresh=function(){var e,t,n;var r=a(this.textRange);if(o(this.textRange))t=e=i(this.textRange,r,true,true).boundaryPosition;else{n=i(this.textRange,r,true,false);e=n.boundaryPosition;t=i(this.textRange,r,false,false,n.nodeInfo).boundaryPosition}this.setStart(e.node,e.offset);this.setEnd(t.node,t.offset)};e.prototype.getName=function(){return"WrappedTextRange"};v.copyComparisonConstants(e);var t=function(e){if(e.collapsed)return s(new w(e.startContainer,e.startOffset),true);else{var t=s(new w(e.startContainer,e.startOffset),true);var n=s(new w(e.endContainer,e.endOffset),false);var r=p(v.getRangeDocument(e)).createTextRange();r.setEndPoint("StartToStart",t);r.setEndPoint("EndToEnd",n);return r}};e.rangeToTextRange=t;e.prototype.toTextRange=function(){return t(this)};d.WrappedTextRange=e;if(!d.features.implementsDomRange||d.config.preferTextRange){var n=function(e){return e("return this;")()}(Function);if(typeof n.Range=="undefined")n.Range=e;d.createNativeRange=function(e){e=m(e,u,"createNativeRange");return p(e).createTextRange()};d.WrappedRange=e}}d.createRange=function(e){e=m(e,u,"createRange");return new d.WrappedRange(d.createNativeRange(e))};d.createRangyRange=function(e){e=m(e,u,"createRangyRange");return new v(e)};g.createAliasForDeprecatedMethod(d,"createIframeRange","createRange");g.createAliasForDeprecatedMethod(d,"createIframeRangyRange","createRangyRange");d.addShimListener(function(e){var t=e.document;if(typeof t.createRange=="undefined")t.createRange=function(){return d.createRange(t)};t=e=null})}),N.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(d,c){d.config.checkSelectionRanges=true;var e="boolean";var t="number";var u=d.dom;var n=d.util;var r=n.isHostMethod;var s=d.DomRange;var o=d.WrappedRange;var a=d.DOMException;var f=u.DomPosition;var i;var l;var h=d.features;var g="Control";var v=u.getDocument;var p=u.getBody;var m=s.rangesEqual;function R(e){return typeof e=="string"?/^backward(s)?$/i.test(e):!!e}function C(e,t){if(!e)return window;else if(u.isWindow(e))return e;else if(e instanceof G)return e.win;else{var n=u.getContentDocument(e,c,t);return u.getWindow(n)}}function N(e){return C(e,"getWinSelection").getSelection()}function E(e){return C(e,"getDocSelection").document.selection}function S(e){var t=false;if(e.anchorNode)t=u.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1;return t}var w=r(window,"getSelection"),y=n.isHostObject(document,"selection");h.implementsWinGetSelection=w;h.implementsDocSelection=y;var T=y&&(!w||d.config.preferTextRange);if(T){i=E;d.isSelectionValid=function(e){var t=C(e,"isSelectionValid").document,n=t.selection;return n.type!="None"||v(n.createRange().parentElement())==t}}else if(w){i=N;d.isSelectionValid=function(){return true}}else{c.fail("Neither document.selection or window.getSelection() detected.");return false}d.getNativeSelection=i;var O=i();if(!O){c.fail("Native selection was null (possibly issue 138?)");return false}var _=d.createNativeRange(document);var D=p(document);var A=n.areHostProperties(O,["anchorNode","focusNode","anchorOffset","focusOffset"]);h.selectionHasAnchorAndFocus=A;var x=r(O,"extend");h.selectionHasExtend=x;var b=typeof O.rangeCount==t;h.selectionHasRangeCount=b;var I=false;var P=true;var B=x?function(e,t){var n=s.getRangeDocument(t);var r=d.createRange(n);r.collapseToPoint(t.endContainer,t.endOffset);e.addRange(F(r));e.extend(t.startContainer,t.startOffset)}:null;if(n.areHostMethods(O,["addRange","getRangeAt","removeAllRanges"])&&typeof O.rangeCount==t&&h.implementsDomRange)(function(){var e=window.getSelection();if(e){var t=e.rangeCount;var n=t>1;var r=[];var a=S(e);for(var o=0;o<t;++o)r[o]=e.getRangeAt(o);var i=u.createTestElement(document,"",false);var s=i.appendChild(document.createTextNode("   "));var c=document.createRange();c.setStart(s,1);c.collapse(true);e.removeAllRanges();e.addRange(c);P=e.rangeCount==1;e.removeAllRanges();if(!n){var f=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(f&&parseInt(f[1])>=36)I=false;else{var l=c.cloneRange();c.setStart(s,0);l.setEnd(s,3);l.setStart(s,2);e.addRange(c);e.addRange(l);I=e.rangeCount==2}}u.removeNode(i);e.removeAllRanges();for(o=0;o<t;++o)if(o==0&&a)if(B)B(e,r[o]);else{d.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend");e.addRange(r[o])}else e.addRange(r[o])}})();h.selectionSupportsMultipleRanges=I;h.collapsedNonEditableSelectionsSupported=P;var M=false,k;if(D&&r(D,"createControlRange")){k=D.createControlRange();if(n.areHostProperties(k,["item","add"]))M=true}h.implementsControlRange=M;if(A)l=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset};else l=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:false};function H(e,t,n){var r=n?"end":"start",a=n?"start":"end";e.anchorNode=t[r+"Container"];e.anchorOffset=t[r+"Offset"];e.focusNode=t[a+"Container"];e.focusOffset=t[a+"Offset"]}function L(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode;e.anchorOffset=t.anchorOffset;e.focusNode=t.focusNode;e.focusOffset=t.focusOffset}function W(e){e.anchorNode=e.focusNode=null;e.anchorOffset=e.focusOffset=0;e.rangeCount=0;e.isCollapsed=true;e._ranges.length=0}function F(e){var t;if(e instanceof s){t=d.createNativeRange(e.getDocument());t.setEnd(e.endContainer,e.endOffset);t.setStart(e.startContainer,e.startOffset)}else if(e instanceof o)t=e.nativeRange;else if(h.implementsDomRange&&e instanceof u.getWindow(e.startContainer).Range)t=e;return t}function j(e){if(!e.length||e[0].nodeType!=1)return false;for(var t=1,n=e.length;t<n;++t)if(!u.isAncestorOf(e[0],e[t]))return false;return true}function z(e){var t=e.getNodes();if(!j(t))throw c.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function V(e){return!!e&&typeof e.text!="undefined"}function U(e,t){var n=new o(t);e._ranges=[n];H(e,n,false);e.rangeCount=1;e.isCollapsed=n.collapsed}function q(e){e._ranges.length=0;if(e.docSelection.type=="None")W(e);else{var t=e.docSelection.createRange();if(V(t))U(e,t);else{e.rangeCount=t.length;var n,r=v(t.item(0));for(var a=0;a<e.rangeCount;++a){n=d.createRange(r);n.selectNode(t.item(a));e._ranges.push(n)}e.isCollapsed=e.rangeCount==1&&e._ranges[0].collapsed;H(e,e._ranges[e.rangeCount-1],false)}}}function Y(e,t){var n=e.docSelection.createRange();var r=z(t);var a=v(n.item(0));var o=p(a).createControlRange();for(var i=0,s=n.length;i<s;++i)o.add(n.item(i));try{o.add(r)}catch(e){throw c.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select();q(e)}var Q;if(r(O,"getRangeAt"))Q=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}};else if(A)Q=function(e){var t=v(e.anchorNode);var n=d.createRange(t);n.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset);if(n.collapsed!==this.isCollapsed)n.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset);return n};function G(e,t,n){this.nativeSelection=e;this.docSelection=t;this._ranges=[];this.win=n;this.refresh()}G.prototype=d.selectionPrototype;function $(e){e.win=e.anchorNode=e.focusNode=e._ranges=null;e.rangeCount=e.anchorOffset=e.focusOffset=0;e.detached=true}var X=[];function Z(e,t){var n=X.length,r,a;while(n--){r=X[n];a=r.selection;if(t=="deleteAll")$(a);else if(r.win==e)if(t=="delete"){X.splice(n,1);return true}else return a}if(t=="deleteAll")X.length=0;return null}var J=function(e){if(e&&e instanceof G){e.refresh();return e}e=C(e,"getNativeSelection");var t=Z(e);var n=i(e),r=y?E(e):null;if(t){t.nativeSelection=n;t.docSelection=r;t.refresh()}else{t=new G(n,r,e);X.push({win:e,selection:t})}return t};d.getSelection=J;n.createAliasForDeprecatedMethod(d,"getIframeSelection","getSelection");var K=G.prototype;function ee(e,t){var n=v(t[0].startContainer);var r=p(n).createControlRange();for(var a=0,o,i=t.length;a<i;++a){o=z(t[a]);try{r.add(o)}catch(e){throw c.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select();q(e)}if(!T&&A&&n.areHostMethods(O,["removeAllRanges","addRange"])){K.removeAllRanges=function(){this.nativeSelection.removeAllRanges();W(this)};var te=function(e,t){B(e.nativeSelection,t);e.refresh()};if(b)K.addRange=function(e,t){if(M&&y&&this.docSelection.type==g)Y(this,e);else if(R(t)&&x)te(this,e);else{var n;if(I)n=this.rangeCount;else{this.removeAllRanges();n=0}var r=F(e).cloneRange();try{this.nativeSelection.addRange(r)}catch(e){}this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==n+1){if(d.config.checkSelectionRanges){var a=Q(this.nativeSelection,this.rangeCount-1);if(a&&!m(a,e))e=new o(a)}this._ranges[this.rangeCount-1]=e;H(this,e,ae(this.nativeSelection));this.isCollapsed=l(this)}else this.refresh()}};else K.addRange=function(e,t){if(R(t)&&x)te(this,e);else{this.nativeSelection.addRange(F(e));this.refresh()}};K.setRanges=function(e){if(M&&y&&e.length>1)ee(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else if(r(O,"empty")&&r(_,"select")&&M&&T){K.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode)e=v(this.anchorNode);else if(this.docSelection.type==g){var t=this.docSelection.createRange();if(t.length)e=v(t.item(0))}if(e){var n=p(e).createTextRange();n.select();this.docSelection.empty()}}}catch(e){}W(this)};K.addRange=function(e){if(this.docSelection.type==g)Y(this,e);else{d.WrappedTextRange.rangeToTextRange(e).select();this._ranges[0]=e;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;H(this,e,false)}};K.setRanges=function(e){this.removeAllRanges();var t=e.length;if(t>1)ee(this,e);else if(t)this.addRange(e[0])}}else{c.fail("No means of selecting a Range or TextRange was found");return false}K.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new a("INDEX_SIZE_ERR");else return this._ranges[e].cloneRange()};var ne;if(T)ne=function(e){var t;if(d.isSelectionValid(e.win))t=e.docSelection.createRange();else{t=p(e.win.document).createTextRange();t.collapse(true)}if(e.docSelection.type==g)q(e);else if(V(t))U(e,t);else W(e)};else if(r(O,"getRangeAt")&&typeof O.rangeCount==t)ne=function(e){if(M&&y&&e.docSelection.type==g)q(e);else{e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount;if(e.rangeCount){for(var t=0,n=e.rangeCount;t<n;++t)e._ranges[t]=new d.WrappedRange(e.nativeSelection.getRangeAt(t));H(e,e._ranges[e.rangeCount-1],ae(e.nativeSelection));e.isCollapsed=l(e)}else W(e)}};else if(A&&typeof O.isCollapsed==e&&typeof _.collapsed==e&&h.implementsDomRange)ne=function(e){var t,n=e.nativeSelection;if(n.anchorNode){t=Q(n,0);e._ranges=[t];e.rangeCount=1;L(e);e.isCollapsed=l(e)}else W(e)};else{c.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}K.refresh=function(e){var t=e?this._ranges.slice(0):null;var n=this.anchorNode,r=this.anchorOffset;ne(this);if(e){var a=t.length;if(a!=this._ranges.length)return true;if(this.anchorNode!=n||this.anchorOffset!=r)return true;while(a--)if(!m(t[a],this._ranges[a]))return true;return false}};var re=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,a=n.length;r<a;++r)if(!m(t,n[r]))e.addRange(n[r]);if(!e.rangeCount)W(e)};if(M&&y)K.removeRange=function(e){if(this.docSelection.type==g){var t=this.docSelection.createRange();var n=z(e);var r=v(t.item(0));var a=p(r).createControlRange();var o,i=false;for(var s=0,c=t.length;s<c;++s){o=t.item(s);if(o!==n||i)a.add(t.item(s));else i=true}a.select();q(this)}else re(this,e)};else K.removeRange=function(e){re(this,e)};var ae;if(!T&&A&&h.implementsDomRange){ae=S;K.isBackward=function(){return ae(this)}}else ae=K.isBackward=function(){return false};K.isBackwards=K.isBackward;K.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")};function oe(e,t){if(e.win.document!=v(t))throw new a("WRONG_DOCUMENT_ERR")}K.collapse=function(e,t){oe(this,e);var n=d.createRange(e);n.collapseToPoint(e,t);this.setSingleRange(n);this.isCollapsed=true};K.collapseToStart=function(){if(this.rangeCount){var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)}else throw new a("INVALID_STATE_ERR")};K.collapseToEnd=function(){if(this.rangeCount){var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)}else throw new a("INVALID_STATE_ERR")};K.selectAllChildren=function(e){oe(this,e);var t=d.createRange(e);t.selectNodeContents(e);this.setSingleRange(t)};K.deleteFromDocument=function(){if(M&&y&&this.docSelection.type==g){var e=this.docSelection.createRange();var t;while(e.length){t=e.item(0);e.remove(t);u.removeNode(t)}this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,a=n.length;r<a;++r)n[r].deleteContents();this.addRange(n[a-1])}}};K.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t};K.getAllRanges=function(){var t=[];this.eachRange(function(e){t.push(e)});return t};K.setSingleRange=function(e,t){this.removeAllRanges();this.addRange(e,t)};K.callMethodOnEachRange=function(t,n){var r=[];this.eachRange(function(e){r.push(e[t].apply(e,n||[]))});return r};function ie(r){return function(e,t){var n;if(this.rangeCount){n=this.getRangeAt(0);n["set"+(r?"Start":"End")](e,t)}else{n=d.createRange(this.win.document);n.setStartAndEnd(e,t)}this.setSingleRange(n,this.isBackward())}}K.setStart=ie(true);K.setEnd=ie(false);d.rangePrototype.select=function(e){J(this.getDocument()).setSingleRange(this,e)};K.changeEachRange=function(t){var n=[];var e=this.isBackward();this.eachRange(function(e){t(e);n.push(e)});this.removeAllRanges();if(e&&n.length==1)this.addRange(n[0],"backward");else this.setRanges(n)};K.containsNode=function(t,n){return this.eachRange(function(e){return e.containsNode(t,n)},true)||false};K.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}};K.moveToBookmark=function(e){var t=[];for(var n=0,r,a;r=e.rangeBookmarks[n++];){a=d.createRange(this.win);a.moveToBookmark(r);t.push(a)}if(e.backward)this.setSingleRange(t[0],"backward");else this.setRanges(t)};K.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}};K.restoreRanges=function(e){this.removeAllRanges();for(var t=0,n;n=e.ranges[t];++t)this.addRange(n,e.backward&&t==0)};K.toHtml=function(){var t=[];this.eachRange(function(e){t.push(s.toHtml(e))});return t.join("")};if(h.implementsTextRange)K.getNativeTextRange=function(){var e,t;if(e=this.docSelection){var n=e.createRange();if(V(n))return n;else throw c.createError("getNativeTextRange: selection is a control selection")}else if(this.rangeCount>0)return d.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));else throw c.createError("getNativeTextRange: selection contains no range")};function se(e){var t=[];var n=new f(e.anchorNode,e.anchorOffset);var r=new f(e.focusNode,e.focusOffset);var a=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var o=0,i=e.rangeCount;o<i;++o)t[o]=s.inspect(e.getRangeAt(o));return"["+a+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}K.getName=function(){return"WrappedSelection"};K.inspect=function(){return se(this)};K.detach=function(){Z(this.win,"delete");$(this)};G.detachAll=function(){Z(null,"deleteAll")};G.inspect=se;G.isDirectionBackward=R;d.Selection=G;d.selectionPrototype=K;d.addShimListener(function(e){if(typeof e.getSelection=="undefined")e.getSelection=function(){return J(e)};e=null})});var L=false,W=function(e){if(!L){L=true;if(!N.initialized&&N.config.autoInitialize)A()}};if(R)if(document.readyState=="complete")W();else{if(d(document,"addEventListener"))document.addEventListener("DOMContentLoaded",W,false);S(window,"load",W)}return N}();return e.createModule("SaveRestore",["WrappedSelection"],function(c,i){var a=c.dom,s=a.removeNode,f=c.Selection.isDirectionBackward,o="\ufeff";function l(e,t){return(t||document).getElementById(e)}function d(e,t){var n="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),r=a.getDocument(e.startContainer),e=e.cloneRange();return e.collapse(t),(t=r.createElement("span")).id=n,t.style.lineHeight="0",t.style.display="none",t.className="rangySelectionBoundary",t.appendChild(r.createTextNode(o)),e.insertNode(t),t}function u(e,t,n,r){e=l(n,e);e?(t[r?"setStartBefore":"setEndBefore"](e),s(e)):i.warn("Marker element has been removed. Cannot restore selection.")}function h(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function g(e,t){var n,r=c.DomRange.getRangeDocument(e),a=e.toString(),t=f(t);return e.collapsed?{document:r,markerId:(n=d(e,!1)).id,collapsed:!0}:(n=d(e,!1),{document:r,startMarkerId:d(e,!0).id,endMarkerId:n.id,collapsed:!1,backward:t,toString:function(){return"original text: '"+a+"', new text: '"+e.toString()+"'"}})}function r(e,t){var n=e.document;void 0===t&&(t=!0);var r,a,o=c.createRange(n);return e.collapsed?(r=l(e.markerId,n))?(r.style.display="inline",(a=r.previousSibling)&&3==a.nodeType?(s(r),o.collapseToPoint(a,a.length)):(o.collapseBefore(r),s(r))):i.warn("Marker element has been removed. Cannot restore selection."):(u(n,o,e.startMarkerId,!0),u(n,o,e.endMarkerId,!1)),t&&o.normalizeBoundaries(),o}function v(e,t){var n,r,a=[],o=f(t);(e=e.slice(0)).sort(h);for(var i=0,s=e.length;i<s;++i)a[i]=g(e[i],o);for(i=s-1;0<=i;--i)n=e[i],r=c.DomRange.getRangeDocument(n),n.collapsed?n.collapseAfter(l(a[i].markerId,r)):(n.setEndBefore(l(a[i].endMarkerId,r)),n.setStartAfter(l(a[i].startMarkerId,r)));return a}function p(e){for(var t=[],n=e.length-1;0<=n;n--)t[n]=r(e[n],!0);return t}function m(e,t){e=l(t,e);e&&s(e)}c.util.extend(c,{saveRange:g,restoreRange:r,saveRanges:v,restoreRanges:p,saveSelection:function(e){if(!c.isSelectionValid(e))return i.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var t=c.getSelection(e),n=t.getAllRanges(),r=1==n.length&&t.isBackward(),a=v(n,r);return r?t.setSingleRange(n[0],r):t.setRanges(n),{win:e,rangeInfos:a,restored:!1}},restoreSelection:function(e,t){var n,r,a;e.restored||(n=e.rangeInfos,r=c.getSelection(e.win),a=p(n),1==n.length&&t&&c.features.selectionHasExtend&&n[0].backward?(r.removeAllRanges(),r.addRange(a[0],!0)):r.setRanges(a),e.restored=!0)},removeMarkerElement:m,removeMarkers:function(e){for(var t,n=e.rangeInfos,r=0,a=n.length;r<a;++r)(t=n[r]).collapsed?m(e.doc,t.markerId):(m(e.doc,t.startMarkerId),m(e.doc,t.endMarkerId))}})}),{rangy:e}}angular.module("angularjstexteditorRangy",[]).factory("$rangy",e),e.$inject=[]}();